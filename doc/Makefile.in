# -----------------------------------------------------------------
# Programmer(s): Radu Serban, Slaven Peles, Cody Balos @ LLNL
# -----------------------------------------------------------------
# SUNDIALS Copyright Start
# Copyright (c) 2002-2021, Lawrence Livermore National Security
# and Southern Methodist University.
# All rights reserved.
#
# See the top-level LICENSE and NOTICE files for details.
#
# SPDX-License-Identifier: BSD-3-Clause
# SUNDIALS Copyright End
# -----------------------------------------------------------------
# Makefile for SUNDIALS documentation
# -----------------------------------------------------------------

QUIET =

SHARED_DIR = ../sundials
HTML_DIR   = ../../html/documentation

# Use pdflatex as default compiler
TEX_COMPILER = pdflatex

UG_SHARED_FILES = \
fortran.tex \
fortran2003.tex \
gpu.tex \
install.tex \
license_info.tex \
linear-vector-table.tex \
linsolv.tex \
nvec_generic.tex \
nvec_serial.tex \
nvec_parallel.tex \
nvec_openmp.tex \
nvec_openmpdev.tex \
nvec_pthreads.tex \
nvec_parhyp.tex \
nvec_petsc.tex \
nvec_cuda.tex \
nvec_hip.tex \
nvec_raja.tex \
nvec_sycl.tex \
nvec_trilinos.tex \
nvec_manyvector.tex \
nvec_mpimanyvector.tex \
nvec_mpiplusx.tex \
nvec_examples.tex \
spils_constants.tex \
sun_org.tex \
sundials_release_history.tex \
sundials_version.tex \
sunmatrix_generic.tex \
sunmatrix_band.tex \
sunmatrix_dense.tex \
sunmatrix_sparse.tex \
sunmatrix_slunrloc.tex \
sunmatrix_cusparse.tex \
sunmatrix_magmadense.tex \
sunmatrix_examples.tex \
sunmemory_generic.tex \
sunmemory_cuda.tex \
sunmemory_hip.tex \
sunmemory_sycl.tex \
sunlinsol_generic.tex \
sunlinsol_band.tex \
sunlinsol_dense.tex \
sunlinsol_klu.tex \
sunlinsol_lapackband.tex \
sunlinsol_lapackdense.tex \
sunlinsol_magmadense.tex \
sunlinsol_pcg.tex \
sunlinsol_spbcgs.tex \
sunlinsol_spfgmr.tex \
sunlinsol_spgmr.tex \
sunlinsol_sptfqmr.tex \
sunlinsol_superludist.tex \
sunlinsol_superlumt.tex \
sunlinsol_cusolversp.tex \
sunlinsol_examples.tex \
sunnonlinsol_generic.tex \
sunnonlinsol_newton.tex \
sunnonlinsol_fixedpoint.tex \
sunnonlinsol_petscsnes.tex \
types.tex \
ug.tex \
biblio.bib
#texi2dvi
#ug_html.tex \
#processHTML

UG_SHARED_FIGURES = \
bandmat.pdf \
cscmat.pdf \
sunorg1.pdf \
sunorg2.pdf \
doc_logo_blue.pdf \
warning.pdf

UG_CMAKE_FIGURES = \
ccmakedefault.png \
ccmakeempty.pdf \
ccmakeprefix.png \
testrunnertop.png \
testrunnerbot.png \
cmaketest.pdf

EX_SHARED_FILES = \
ug.tex \
biblio.bib
#texi2dvi \
#ug_html.tex \
#processHTML

#HTML_BUTTONS =\
#back.png \
#contents.png \
#index.png \
#next.png \
#next_g.png \
#prev.png \
#prev_g.png \
#up.png \
#up_g.png \
#warning.png

UG_SHARED = $(addprefix $(SHARED_DIR)/, ${UG_SHARED_FILES})
UG_SHARED += $(addprefix $(SHARED_DIR)/figures/, ${UG_SHARED_FIGURES})
UG_SHARED += $(addprefix $(SHARED_DIR)/figures/cmake/, ${UG_CMAKE_FIGURES})

EX_SHARED = $(addprefix $(SHARED_DIR)/, ${EX_SHARED_FILES})

export TEXINPUTS=./:${SHARED_DIR}//:${SHARED_DIR}/figures//:
export BIBINPUTS=./:${SHARED_DIR}//:
export BSTINPUTS=./:${SHARED_DIR}//:

#-------------------------------------------------------------------------------

all:
	@echo "Usage:"
	@echo "  make ug     - compile LaTeX files to generate PDF for User's Guide (pdflatex)"
	@echo "  make ex     - compile LaTeX files to generate PDF for Examples Guide (pdflatex)"
	@echo "  make clean  - remove all temporary files"
	@echo "  make purge  - remove temporary files + PDF files"
	@echo "  make ug_pdf - generate PDF file for User's Guide using pdflatex"
	@echo "  make ex_pdf - generate PDF file for Examples Guide using pdflatex"
	@echo "  make ug_xel - generate PDF file for User's Guide using xelatex"
	@echo "  make ex_xel - generate PDF file for Examples Guide using xelatex"
	@echo ""

install: ug ex
#install: ug_pdf ex_pdf ug_html ex_html
#	rm -rf $(HTML_DIR)/${USER_GUIDE}
#	rm -rf $(HTML_DIR)/${EXAMPLES}
#	cp ${USER_GUIDE}.ps $(HTML_DIR)
	cp ${USER_GUIDE}.pdf $(HTML_DIR)
#	cp -r ${USER_GUIDE} $(HTML_DIR)
#	cp ${EXAMPLES}.ps $(HTML_DIR)
	cp ${EXAMPLES}.pdf $(HTML_DIR)
#	cp -r ${EXAMPLES} $(HTML_DIR)

#-------------------------------------------------------------------------------

ug: ${USER_GUIDE}.pdf

ug_pdf: use_pdflatex ug

ug_xel: use_xelatex ug

#ug_html: ug
#	cp ug_html.tex ug.tex
#	latex2html -split 3 -link 3 -info 1 -no_math -html_version 3.2,math -show_section_numbers -short_index -local_icons -white -notransparent ${USER_GUIDE}.tex
#	@for i in ${HTML_BUTTONS} ; do \
#	cp ${SHARED_DOC}/buttons/$${i} ${USER_GUIDE}/ ;\
#	done
#	@cp ${SHARED_DOC}/l2h_styles.css ${USER_GUIDE}/${USER_GUIDE}.css
#	./processHTML ${USER_GUIDE}

${USER_GUIDE}.pdf: ${UG_FILES} ${UG_SHARED}
	${TEX_COMPILER} ${QUIET} ${USER_GUIDE}.tex
	bibtex ${USER_GUIDE}
	makeindex ${USER_GUIDE}.idx
	${TEX_COMPILER} ${QUIET} ${USER_GUIDE}.tex
	${TEX_COMPILER} ${QUIET} ${USER_GUIDE}.tex

#-------------------------------------------------------------------------------

ex: ug ${EXAMPLES}.pdf

ex_pdf: use_pdflatex ex

ex_xel: use_xelatex ex

#ex_html: ex
#	cp ug_html.tex ug.tex
#	latex2html -split 4 -link 4 -info 1 -no_math -html_version 3.2,math -show_section_numbers -local_icons -white -notransparent ${EXAMPLES}.tex
#	@for i in ${HTML_BUTTONS} ; do \
#	cp ${SHARED_DOC}/buttons/$${i} ${EXAMPLES}/ ;\
#	done
#	@cp ${SHARED_DOC}/l2h_styles.css ${EXAMPLES}/${EXAMPLES}.css
#	./processHTML ${EXAMPLES}

${EXAMPLES}.pdf: ${EX_FILES} ${EX_SHARED}
	${TEX_COMPILER} ${QUIET} ${EXAMPLES}.tex
	bibtex ${EXAMPLES}
	makeindex ${EXAMPLES}.idx
	${TEX_COMPILER} ${QUIET} ${EXAMPLES}.tex
	${TEX_COMPILER} ${QUIET} ${EXAMPLES}.tex

#-------------------------------------------------------------------------------

use_pdflatex:
	$(eval TEX_COMPILER := pdflatex)

use_xelatex:
	$(eval TEX_COMPILER := xelatex)

clean:
	rm -f *~ *.aux *.bbl *.blg *.log *.toc *.lot *.lof *.ist *.ind *.ilg *.idx *.dvi *.out

purge:  clean
	rm -f ${USER_GUIDE}.pdf
	rm -f ${EXAMPLES}.pdf
