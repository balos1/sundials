%===================================================================================
\chapter{Description of the SUNMatrix module}\label{s:sunmatrix}
%===================================================================================
\index{SUNMatrix@\texttt{SUNMatrix} module}
\input{sunmatrix_generic}


%---------------------------------------------------------------------------
\section{SUNMatrix functions used by CVODES}
\label{s:sunmat_usage}
%---------------------------------------------------------------------------

In Table \ref{t:sunmatuse}, we list the matrix functions in the
{\sunmatrix} module used within the {\cvodes} package.
The table also shows, for each function, which of the code modules uses
the function. The main {\cvodes} integrator does not call any
{\sunmatrix} functions directly, so the table columns are specific to
the {\cvls} interface and the {\cvbandpre} and
{\cvbbdpre} preconditioner modules.  We further note that the {\cvls}
interface only utilizes these routines when supplied with a
\emph{matrix-based} linear solver, i.e., the {\sunmatrix} object
passed to \Id{CVodeSetLinearSolver} was not \id{NULL}.

At this point, we should emphasize that the {\cvodes} user does not need to know
anything about the usage of matrix functions by the {\cvodes} code modules in order
to use {\cvodes}. The information is presented as an implementation detail for the
interested reader.

\begin{table}[htb]
\centering
\caption{List of matrix functions usage by {\cvodes} code modules}\label{t:sunmatuse}
\medskip
\begin{tabular}{|r|c|c|c|} \hline
                                             &
\begin{sideways}{\cvls}       \end{sideways} &
\begin{sideways}{\cvbandpre}  \end{sideways} &
\begin{sideways}{\cvbbdpre}   \end{sideways} \\ \hline\hline
%                            CVLS         BPRE         BBD
\id{SUNMatGetID}         &    \cm    &           &           \\ \hline
\id{SUNMatClone}         &    \cm    &           &           \\ \hline
\id{SUNMatDestroy}       &    \cm    &    \cm    &    \cm    \\ \hline
\id{SUNMatZero}          &    \cm    &    \cm    &    \cm    \\ \hline
\id{SUNMatCopy}          &    \cm    &    \cm    &    \cm    \\ \hline
\id{SUNMatScaleAddI}     &    \cm    &    \cm    &    \cm    \\ \hline
\id{SUNMatSpace}         & $\dagger$ & $\dagger$ & $\dagger$ \\ \hline
\end{tabular}
\end{table}

The matrix functions listed in Section \ref{ss:sunmatrix_functions} with
a $\dagger$ symbol are optionally used, in that these are only called
if they are implemented in the {\sunmatrix} module that is being used
(i.e.~their function pointers are non-\id{NULL}).  The matrix
functions listed in Section \ref{ss:sunmatrix_functions} that are {\em not} used by
{\cvodes} are: \id{SUNMatScaleAdd} and \id{SUNMatMatvec}.
Therefore a user-supplied {\sunmatrix} module for {\cvodes} could omit
these functions.

We note that the {\cvbandpre} and {\cvbbdpre} preconditioner modules
are hard-coded to use the {\sundials}-supplied band {\sunmatrix} type,
so the most useful information above for user-supplied {\sunmatrix}
implementations is the column relating the {\cvls} requirements.

%---------------------------------------------------------------------------
% sunmatrix module sections
%---------------------------------------------------------------------------

\input{sunmatrix_dense}
\input{sunmatrix_band}
\input{sunmatrix_sparse}
\input{sunmatrix_slunrloc}
\input{sunmatrix_cusparse}
\input{sunmatrix_magmadense}
\input{sunmatrix_onemkldense}
