%===================================================================================
\chapter{Description of the NVECTOR module}\label{s:nvector}
%===================================================================================
\index{NVECTOR@\texttt{NVECTOR} module}
\input{nvec_generic}


%---------------------------------------------------------------------------
\section{NVECTOR functions used by KINSOL}

In Table \ref{t:nvecuse} below, we list the vector functions in the
{\nvector} module used within the {\kinsol} package.
The table also shows, for each function, which of the code modules uses
the function. The {\kinsol} column shows function usage within the main
solver module, while the remaining five columns show function
usage within each of the {\kinsol} linear solver interfaces,
the {\kinbbdpre} preconditioner module, and the {\fkinsol} module.
Here {\kinls} stands for the generic linear solver interface in {\kinsol}.

At this point, we should emphasize that the {\kinsol} user does not need to know
anything about the usage of vector functions by the {\kinsol} code modules in order
to use {\kinsol}. The information is presented as an implementation detail for the
interested reader.

\begin{table}[htb]
\centering
\caption{List of vector functions usage by {\kinsol} code modules}\label{t:nvecuse}
\medskip
\begin{tabular}{|r|c|c|c|c|c|} \hline
                                            &
\begin{sideways}{\kinsol}    \end{sideways} &
\begin{sideways}{\kinls}     \end{sideways} &
\begin{sideways}{\kinbbdpre} \end{sideways} &
\begin{sideways}{\fkinsol}   \end{sideways} \\ \hline\hline
%                           KINSOL   LS   BPRE  FKINSOL
\id{N\_VGetVectorID}        &     &     &     &     \\ \hline
\id{N\_VGetLength}          &     &  4  &     &     \\ \hline
\id{N\_VClone}              & \cm &     & \cm &     \\ \hline
\id{N\_VCloneEmpty}         &     &     &     & \cm \\ \hline
\id{N\_VDestroy}            & \cm &     & \cm & \cm \\ \hline
\id{N\_VSpace}              & \cm &  2  &     &     \\ \hline
\id{N\_VGetArrayPointer}    &     &  1  & \cm & \cm \\ \hline
\id{N\_VSetArrayPointer}    &     &  1  &     & \cm \\ \hline
\id{N\_VLinearSum}          & \cm & \cm &     &     \\ \hline
\id{N\_VConst}              &     & \cm &     &     \\ \hline
\id{N\_VProd}               & \cm & \cm &     &     \\ \hline
\id{N\_VDiv}                & \cm &     &     &     \\ \hline
\id{N\_VScale}              & \cm & \cm & \cm &     \\ \hline
\id{N\_VAbs}                & \cm &     &     &     \\ \hline
\id{N\_VInv}                & \cm &     &     &     \\ \hline
\id{N\_VDotProd}            & \cm & \cm &     &     \\ \hline
\id{N\_VMaxNorm}            & \cm &     &     &     \\ \hline
\id{N\_VMin}                & \cm &     &     &     \\ \hline
\id{N\_VWL2Norm}            & \cm & \cm &     &     \\ \hline
\id{N\_VL1Norm}             &     &  3  &     &     \\ \hline
\id{N\_VConstrMask}         & \cm &     &     &     \\ \hline
\id{N\_VMinQuotient}        & \cm &     &     &     \\ \hline
\hline
\id{N\_VLinearCombination}  & \cm & \cm &     &     \\ \hline
\id{N\_VDotProdMulti}       & \cm &     &     &     \\ \hline
\end{tabular}
\end{table}

Special cases (numbers match markings in table):
\begin{enumerate}
\item These routines are only required if an internal
  difference-quotient routine for constructing dense or band
  Jacobian matrices is used.
\item This routine is optional, and is only used in estimating
  space requirements for {\ida} modules for user feedback.
\item These routines are only required if the internal
  difference-quotient routine for approximating the Jacobian-vector
  product is used.
\item This routine is only used when an iterative {\sunlinsol} module
  that does not support the \id{SUNLinSolSetScalingVectors} routine is
  supplied to {\kinsol}.
\end{enumerate}

Each {\sunlinsol} object may require additional {\nvector} routines
not listed in the table above.  Please see the the relevant
descriptions of these modules in Sections
\ref{ss:sunlinsol_dense}-\ref{ss:sunlinsol_pcg} for additional detail
on their {\nvector} requirements.

The vector functions listed in Table \ref{ss:nvecops} that are {\em not} used by
{\kinsol} are \id{N\_VAddConst}, \id{N\_VWrmsNorm}, \id{N\_VWrmsNormMask},
\id{N\_VCompare}, \id{N\_VInvTest}, and \id{N\_VGetCommunicator}.
Therefore a user-supplied {\nvector} module for {\kinsol} could omit these
functions.

The optional function \id{N\_VLinearCombination} is only used when
Anderson acceleration is enabled or the {\spbcg}, {\sptfqmr},
{\spgmr}, or {\spfgmr} linear solvers are used. \id{N\_VDotProd} is
only used when Anderson acceleration is enabled or Classical
Gram-Schmidt is used with {\spgmr} or {\spfgmr}. The remaining
operations from Tables \ref{ss:nvecfusedops} and \ref{ss:nvecarrayops}
are unused and a user-supplied {\nvector} module for {\kinsol} could
omit these operations.

%---------------------------------------------------------------------------
% nvector module sections
%---------------------------------------------------------------------------

\input{nvec_serial}
\input{nvec_parallel}
\input{nvec_openmp}
\input{nvec_pthreads}
\input{nvec_parhyp}
\input{nvec_petsc}
\input{nvec_cuda}
\input{nvec_raja}
\input{nvec_openmpdev}
\input{nvec_trilinos}
\input{nvec_manyvector}
\input{nvec_mpimanyvector}
\input{nvec_mpiplusx}
\input{nvec_examples}
