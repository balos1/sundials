%===================================================================================
\chapter{Description of the SUNMatrix module}\label{s:sunmatrix}
%===================================================================================
\index{SUNMatrix@\texttt{SUNMatrix} module}
\input{sunmatrix_generic}


%---------------------------------------------------------------------------
\section{SUNMatrix functions used by KINSOL}
\label{s:sunmat_usage}
%---------------------------------------------------------------------------

In Table \ref{t:sunmatuse} below, we list the matrix functions in the 
{\sunmatrix} module used within the {\kinsol} package.
The table also shows, for each function, which of the code modules uses
the function. The main {\kinsol} integrator does not call any
{\sunmatrix} functions directly, so the table columns are specific to
the {\kinls} interface and the {\kinbbdpre} preconditioner module.  We
further note that the {\kinls} interface only utilizes these routines
when supplied with a \emph{matrix-based} linear solver, i.e., the
{\sunmatrix} object passed to \Id{KINSetLinearSolver} was not \id{NULL}.

At this point, we should emphasize that the {\kinsol} user does not need
to know anything about the usage of matrix functions by the {\kinsol}
code modules in order to use {\kinsol}. The information is presented as
an implementation detail for the interested reader.

\begin{table}[htb]
\centering
\caption{List of matrix functions usage by {\kinsol} code modules}\label{t:sunmatuse}
\medskip
\begin{tabular}{|r|c|c|} \hline
                                             & 
\begin{sideways}{\kinls}       \end{sideways} & 
\begin{sideways}{\kinbbdpre}   \end{sideways} \\ \hline\hline
%                             KINLS       BBD
\id{SUNMatGetID}         &    \cm    &           \\ \hline
\id{SUNMatDestroy}       &           &    \cm    \\ \hline
\id{SUNMatZero}          &    \cm    &    \cm    \\ \hline
\id{SUNMatSpace}         &           & $\dagger$ \\ \hline
\end{tabular}
\end{table}

The matrix functions listed in Section \ref{ss:sunmatrix_functions} with
a $\dagger$ symbol are optionally used, in that these are only called
if they are implemented in the {\sunmatrix} module that is being used
(i.e.~their function pointers are non-\id{NULL}).  The matrix
functions listed in Section \ref{ss:sunmatrix_functions} that are {\em not} used by 
{\kinsol} are: \id{SUNMatCopy}, \id{SUNMatClone}, \id{SUNMatScaleAdd},
\id{SUNMatScaleAddI} and \id{SUNMatMatvec}. Therefore a user-supplied
{\sunmatrix} module for {\kinsol} could omit these functions.

We note that the {\kinbbdpre} preconditioner module is hard-coded to
use the {\sundials}-supplied band {\sunmatrix} type, so the most
useful information above for user-supplied {\sunmatrix}
implementations is the column relating the {\kinls} requirements. 

%---------------------------------------------------------------------------
% sunmatrix module sections
%---------------------------------------------------------------------------

\input{sunmatrix_dense}
\input{sunmatrix_band}
\input{sunmatrix_sparse}
\input{sunmatrix_slunrloc}
\input{sunmatrix_cusparse}