%%
\section{The SUNLinearSolver\_MagmaDense implementation}\label{ss:sunlinsol_magmadense}

The \id{SUNLinearSolver\_MagmaDense} implementation of the {\sunlinsol} API is
designed to be used with the \id{SUNMATRIX\_MAGMADENSE} matrix, and a
GPU-enabled vector. This implementation interfaces to the MAGMA
(\href{https://icl.utk.edu/magma/}) linear algebra library and can target
NVIDIA's CUDA programming model or AMD's HIP programming model \cite{magma_ref}.

The header file to include when using this module is
\id{sunlinsol/sunlinsol\_magmadense.h}. The installed library to link to is
\id{libsundials\_sunlinsolmagmadense.\textit{lib}} where \id{\em.lib} is
typically \id{.so} for shared libraries and \id{.a} for static libraries.
\newline
\newline
{\warn}The \id{SUNLinearSolver\_MagmaDense} module is experimental and subject to change.

% --------------------------------------------------------------------
\subsection{SUNLinearSolver\_MagmaDense description}\label{ss:sunlinsol_magmadense_description}

The \id{SUNLinearSolver\_MagmaDense} implementation provides an interface to
the dense LU and dense batched LU methods in the MAGMA linear algebra library
\cite{magma_site}. The batched LU methods are leveraged when solving block diagonal
linear systems of the form
\begin{equation*}
  \begin{bmatrix}
    \mathbf{A_0} & 0 & \cdots & 0\\
    0 & \mathbf{A_1} & \cdots & 0\\
    \vdots & \vdots & \ddots & \vdots\\
    0 & 0 & \cdots & \mathbf{A_{n-1}}\\
  \end{bmatrix}
  x_j
  =
  b_j.
\end{equation*}


% % --------------------------------------------------------------------
\subsection{SUNLinearSolver\_MagmaDense functions}\label{ss:sunlinsol_magmadense_functions}

The \id{SUNLinearSolver\_MagmaDense} module defines implementations of
all ``direct'' linear solver operations listed in
Sections \ref{ss:sunlinsol_CoreFn}-\ref{ss:sunlinsol_GetFn}:
%%
%%
\begin{itemize}
\item \id{SUNLinSolGetType\_MagmaDense}
\item \id{SUNLinSolInitialize\_MagmaDense}
\item \id{SUNLinSolSetup\_MagmaDense}
\item \id{SUNLinSolSolve\_MagmaDense}
\item \id{SUNLinSolLastFlag\_MagmaDense}
\item \id{SUNLinSolFree\_MagmaDense}
\end{itemize}
%%
%%
In addition, the module provides the following user-callable routines:
%%
%%
\ucfunction{SUNLinSol\_MagmaDense}
{
  LS = SUNLinSol\_MagmaDense(y, A);
}
{
  The function \ID{SUNLinSol\_MagmaDense} creates and allocates memory for a
  {\sunlinsol} object.
}
{
  \begin{args}[A]
  \item[y] (\id{N\_Vector})
    a vector for checking compatibility with the solver
  \item[A] (\id{SUNMatrix})
    a \id{SUNMATRIX\_MAGMADENSE} matrix for checking compatibility with the solver
  \end{args}
}
{
  This returns a \id{SUNLinearSolver} object.  If either \id{A} or
  \id{y} are incompatible then this routine will return \id{NULL}.
}
{
  This routine analyzes the input matrix and vector to determine the
  linear system size and to assess compatibility with the solver.
}
%%
%%
\ucfunction{SUNLinSol\_MagmaDense\_SetAsync}
{
  SUNLinSol\_MagmaDense\_SetAsync(SUNLinearSolver LS, booleantype onoff);
}
{
  The function \id{SUNLinSol\_MagmaDense\_SetAsync} can be used to toggle the
  linear solver between asynchronous and synchronous modes. In asynchronous
  mode, \id{SUNLinearSolver} operations are asynchronous with respect to the
  host. In synchronous mode, the host and GPU device are synchronized prior to
  the operation returning.
}
{
  \begin{args}[onoff]
  \item[LS] (\id{SUNLinearSolver})
    a \id{SUNLinSol\_MagmaDense} object
  \item[onoff] (\id{booleantype})
    set to 0 for synchronous mode, or 1 for asynchronous mode
  \end{args}
}
{ None }
{
  The default is asynchronous mode.
}

% --------------------------------------------------------------------
\subsection{SUNLinearSolver\_MagmaDense content}\label{ss:sunlinsol_magmadense_content}

The \id{SUNLinearSolver\_MagmaDense} module defines the
{\em content} field of a \id{SUNLinearSolver} to be the following structure:
%%
\begin{verbatim}
struct _SUNLinearSolverContent_MagmaDense {
  int             last_flag;
  booleantype     async;
  sunindextype    N;
  SUNMemory       pivots;
  SUNMemory       pivotsarr;
  SUNMemory       dpivotsarr;
  SUNMemory       infoarr;
  SUNMemory       rhsarr;
  SUNMemoryHelper memhelp;
  magma_queue_t   q;
};
\end{verbatim}
